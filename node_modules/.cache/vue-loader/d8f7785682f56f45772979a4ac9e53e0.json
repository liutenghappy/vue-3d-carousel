{"remainingRequest":"C:\\Users\\Administrator\\AppData\\Roaming\\npm\\node_modules\\@vue\\cli-service-global\\node_modules\\_vue-loader@15.9.6@vue-loader\\lib\\index.js??vue-loader-options!D:\\项目\\vue-3d-carousel\\src\\carousel.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\项目\\vue-3d-carousel\\src\\carousel.vue","mtime":1615699907502},{"path":"C:\\Users\\Administrator\\AppData\\Roaming\\npm\\node_modules\\@vue\\cli-service-global\\node_modules\\_babel-loader@8.2.2@babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Administrator\\AppData\\Roaming\\npm\\node_modules\\@vue\\cli-service-global\\node_modules\\_cache-loader@4.1.0@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\AppData\\Roaming\\npm\\node_modules\\@vue\\cli-service-global\\node_modules\\_vue-loader@15.9.6@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJjYXJvdXNlbCIsDQogIHByb3ZpZGUoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGNhcm91c2VsOiB0aGlzDQogICAgfTsNCiAgfSwNCg0KICBwcm9wczogew0KICAgIHdpZHRoOiB7DQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgICBkZWZhdWx0OiAiMTAwJSINCiAgICB9LA0KICAgIGhlaWdodDogew0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgICAgZGVmYXVsdDogIjQ2MHB4Ig0KICAgIH0sDQogICAgZmFyU2NhbGU6IHsNCiAgICAgIC8v5pyA6L+c5pe255qE57yp5pS+DQogICAgICB0eXBlOiBOdW1iZXIsDQogICAgICBkZWZhdWx0OiAwLjUNCiAgICB9LA0KICAgIHhSYWRpdXM6IHsNCiAgICAgIHR5cGU6IE51bWJlcg0KICAgIH0sDQogICAgeVJhZGl1czogew0KICAgICAgdHlwZTogTnVtYmVyDQogICAgfSwNCiAgICBzcGVlZDogew0KICAgICAgdHlwZTogTnVtYmVyLA0KICAgICAgZGVmYXVsdDogNA0KICAgIH0sDQogICAgYXV0b1BsYXk6IHsNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgICBkZWZhdWx0OiBmYWxzZQ0KICAgIH0sDQogICAgaW50ZXJ2YWw6IHsNCiAgICAgIHR5cGU6IE51bWJlciwNCiAgICAgIGRlZmF1bHQ6IDMwMDANCiAgICB9LA0KICAgIGlzTW90aW9uOiB7DQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgICAgZGVmYXVsdDogZmFsc2UNCiAgICB9DQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGNvdW50OiAwLA0KICAgICAgaXRlbXM6IFtdLA0KICAgICAgcm90YXRpb246IE1hdGguUEkgLyAyLA0KICAgICAgZGVzdFJvdGF0aW9uOiBNYXRoLlBJIC8gMiwNCiAgICAgIGxhc3RUaW1lOiBEYXRlLm5vdygpLA0KICAgICAgdGltZXI6IDAsDQogICAgICBhdXRvUGxheVRpbWVyOiBudWxsLA0KICAgICAgdW5pZm9ybU1vdGlvblRpbWVyOiBudWxsLA0KICAgICAgaW5kZXg6IDANCiAgICB9Ow0KICB9LA0KICBjb21wdXRlZDogew0KICAgIHN0eWxlT2JqKCkgew0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgd2lkdGg6IHRoaXMud2lkdGgsDQogICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQNCiAgICAgIH07DQogICAgfSwNCiAgICB5UigpIHsNCiAgICAgIHJldHVybiB0aGlzLnlSYWRpdXMgfHwgdGhpcy4kZWwub2Zmc2V0SGVpZ2h0IC8gNjsNCiAgICB9LA0KICAgIHhSKCkgew0KICAgICAgcmV0dXJuIHRoaXMueFJhZGl1cyB8fCB0aGlzLiRlbC5vZmZzZXRXaWR0aCAvIDIuMzsNCiAgICB9LA0KICAgIHhPcmlnaW4oKSB7DQogICAgICByZXR1cm4gdGhpcy4kZWwub2Zmc2V0V2lkdGggLyAyOw0KICAgIH0sDQogICAgeU9yaWdpbigpIHsNCiAgICAgIHJldHVybiB0aGlzLiRlbC5vZmZzZXRIZWlnaHQgLyAxMDsNCiAgICB9LA0KICAgIGFjdGl2ZUluZGV4KCkgew0KICAgICAgcmV0dXJuIE1hdGgucm91bmQodGhpcy5mbG9hdEluZGV4KCkpICUgdGhpcy5jb3VudDsNCiAgICB9DQogIH0sDQogIG1vdW50ZWQoKSB7DQogICAgdGhpcy5pbml0SXRlbSgpOw0KICAgIGlmICh0aGlzLmF1dG9QbGF5KSB0aGlzLnN0YXJ0KCk7DQogICAgdGhpcy51bmlmb3JtTW90aW9uKCk7DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBpbml0SXRlbSgpIHsNCiAgICAgIC8vICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgbGV0IHJhZGlhbnMgPSB0aGlzLnJvdGF0aW9uOw0KICAgICAgdGhpcy5jb3VudCA9IHRoaXMuaXRlbXMubGVuZ3RoOw0KICAgICAgbGV0IHNwYWNlID0gKDIgKiBNYXRoLlBJKSAvIHRoaXMuY291bnQ7DQogICAgICB0aGlzLml0ZW1zLmZvckVhY2goZWxlID0+IHsNCiAgICAgICAgZWxlLnJvdGF0aW9uID0gcmFkaWFuczsNCiAgICAgICAgZWxlLnJlbmRlckl0ZW0oKTsNCiAgICAgICAgcmFkaWFucyArPSBzcGFjZTsNCiAgICAgIH0pOw0KICAgICAgLy8gICB9KTsNCiAgICB9LA0KICAgIHNjaGVkdWxlTmV4dEZyYW1lKCkgew0KICAgICAgdGhpcy5sYXN0VGltZSA9IERhdGUubm93KCk7DQogICAgICB0aGlzLnRpbWVyID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnBsYXlGcmFtZSk7DQogICAgfSwNCiAgICBwbGF5KCkgew0KICAgICAgaWYgKHRoaXMudGltZXIgPT09IDApIHsNCiAgICAgICAgdGhpcy5zY2hlZHVsZU5leHRGcmFtZSgpOw0KICAgICAgfQ0KICAgIH0sDQogICAgcGxheUZyYW1lKCkgew0KICAgICAgdmFyIHJlbSA9IHRoaXMuZGVzdFJvdGF0aW9uIC0gdGhpcy5yb3RhdGlvbjsNCiAgICAgIHZhciBub3cgPSBEYXRlLm5vdygpOw0KICAgICAgdmFyIGR0ID0gKG5vdyAtIHRoaXMubGFzdFRpbWUpICogMC4wMDI7DQogICAgICB0aGlzLmxhc3RUaW1lID0gbm93Ow0KICAgICAgaWYgKE1hdGguYWJzKHJlbSkgPCAwLjAwMykgew0KICAgICAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5kZXN0Um90YXRpb247DQogICAgICAgIHRoaXMucGF1c2UoKTsNCiAgICAgICAgdGhpcy4kZW1pdCgiY2hhbmdlIiwgdGhpcy5hY3RpdmVJbmRleCk7DQogICAgICAgIHRoaXMudW5pZm9ybU1vdGlvbigpOw0KICAgICAgICBpZiAodHlwZW9mIHRoaXMub25BbmltYXRpb25GaW5pc2hlZCA9PT0gImZ1bmN0aW9uIikNCiAgICAgICAgICB0aGlzLm9uQW5pbWF0aW9uRmluaXNoZWQoKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vIOa4kOi/keWcsOaOpei/keebruaghw0KICAgICAgICB0aGlzLnJvdGF0aW9uID0gdGhpcy5kZXN0Um90YXRpb24gLSByZW0gLyAoMSArIHRoaXMuc3BlZWQgKiBkdCk7DQogICAgICAgIHRoaXMuc2NoZWR1bGVOZXh0RnJhbWUoKTsNCiAgICAgIH0NCg0KICAgICAgdGhpcy5pbml0SXRlbSgpOw0KICAgIH0sDQogICAgcGF1c2UoKSB7DQogICAgICBjb25zb2xlLmxvZygi5pqC5YGcIik7DQogICAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy50aW1lcik7DQogICAgICB0aGlzLnRpbWVyID0gMDsNCiAgICB9LA0KICAgIGdvKGNvdW50KSB7DQogICAgICB0aGlzLmRlc3RSb3RhdGlvbiArPSAoKDIgKiBNYXRoLlBJKSAvIHRoaXMuY291bnQpICogY291bnQ7DQogICAgICB0aGlzLnBsYXkoKTsNCiAgICB9LA0KICAgIGdvVG8oaW5kZXgpIHsNCiAgICAgIHRoaXMuc3RvcE1vdGlvbigpOw0KICAgICAgdGhpcy5zdG9wKCk7DQogICAgICAvL+aJvuWIsOWwhumhueebruaXi+i9rOWIsOWJjemdoueahOacgOefreaWueazlQ0KICAgICAgbGV0IGRpZmYgPSBpbmRleCAtICh0aGlzLmZsb2F0SW5kZXgoKSAlIHRoaXMuY291bnQpOw0KDQogICAgICBpZiAoMiAqIE1hdGguYWJzKGRpZmYpID4gdGhpcy5jb3VudCkNCiAgICAgICAgZGlmZiAtPSBkaWZmID4gMCA/IHRoaXMuY291bnQgOiAtdGhpcy5jb3VudDsNCg0KICAgICAgLy8g5YGc5q2i5Lu75L2V5q2j5Zyo6L+b6KGM55qE5peL6L2sDQogICAgICB0aGlzLmRlc3RSb3RhdGlvbiA9IHRoaXMucm90YXRpb247DQoNCiAgICAgIC8vIOaXi+i9rOebuOWPjeeahOaWueWQkeaKiumhueebruW4puWIsOWJjemdog0KICAgICAgdGhpcy5nbygtZGlmZik7DQoNCiAgICAgIC8vIOi/lOWbnuWIsOebruagh+eahOaXi+i9rOi3neemuyjku6Xpobnnm67kuLrljZXkvY0pDQogICAgICByZXR1cm4gZGlmZjsNCiAgICB9LA0KICAgIGl0ZW1zUm90YXRlZCgpIHsNCiAgICAgIHJldHVybiAodGhpcy5jb3VudCAqIChNYXRoLlBJIC8gMiAtIHRoaXMucm90YXRpb24pKSAvICgyICogTWF0aC5QSSk7DQogICAgfSwNCiAgICBmbG9hdEluZGV4KCkgew0KICAgICAgbGV0IGZsb2F0SW5kZXggPSB0aGlzLml0ZW1zUm90YXRlZCgpICUgdGhpcy5jb3VudDsNCg0KICAgICAgLy8g56Gu5L+dZmxvYXQtaW5kZXjmmK/mraPnmoQNCiAgICAgIHJldHVybiBmbG9hdEluZGV4IDwgMCA/IGZsb2F0SW5kZXggKyB0aGlzLmNvdW50IDogZmxvYXRJbmRleDsNCiAgICB9LA0KICAgIHN0YXJ0KCkgew0KICAgICAgdGhpcy5hdXRvUGxheVRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4gew0KICAgICAgICB0aGlzLmdvKDEpOw0KICAgICAgfSwgdGhpcy5pbnRlcnZhbCk7DQogICAgfSwNCiAgICBzdG9wKCkgew0KICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmF1dG9QbGF5VGltZXIpOw0KICAgIH0sDQogICAgdW5pZm9ybU1vdGlvbigpIHsNCiAgICAgIGlmICh0aGlzLmFjdGl2ZUluZGV4ICE9IHRoaXMuaW5kZXgpIHsNCiAgICAgICAgdGhpcy5pbmRleCA9IHRoaXMuYWN0aXZlSW5kZXg7DQogICAgICAgIHRoaXMuJGVtaXQoImNoYW5nZSIsIHRoaXMuaW5kZXgpOw0KICAgICAgfQ0KDQogICAgICB0aGlzLnJvdGF0aW9uICs9IDAuMDA1Ow0KICAgICAgdGhpcy5pbml0SXRlbSgpOw0KICAgICAgdGhpcy51bmlmb3JtTW90aW9uVGltZXIgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKA0KICAgICAgICB0aGlzLnVuaWZvcm1Nb3Rpb24NCiAgICAgICk7DQogICAgfSwNCiAgICBzdG9wTW90aW9uKCkgew0KICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMudW5pZm9ybU1vdGlvblRpbWVyKTsNCiAgICB9DQogIH0sDQoNCiAgY29tcG9uZW50czoge30sDQogIGJlZm9yZURlc3Ryb3koKSB7fQ0KfTsNCg=="},{"version":3,"sources":["carousel.vue"],"names":[],"mappings":";;;;;;;;;;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"carousel.vue","sourceRoot":"src","sourcesContent":["<template>\r\n  <div\r\n    :style=\"styleObj\"\r\n    id=\"carousel\"\r\n  >\r\n    <slot></slot>\r\n  </div>\r\n</template>\r\n\r\n<script type=\"text/javascript\">\r\nexport default {\r\n  name: \"carousel\",\r\n  provide() {\r\n    return {\r\n      carousel: this\r\n    };\r\n  },\r\n\r\n  props: {\r\n    width: {\r\n      type: String,\r\n      default: \"100%\"\r\n    },\r\n    height: {\r\n      type: String,\r\n      default: \"460px\"\r\n    },\r\n    farScale: {\r\n      //最远时的缩放\r\n      type: Number,\r\n      default: 0.5\r\n    },\r\n    xRadius: {\r\n      type: Number\r\n    },\r\n    yRadius: {\r\n      type: Number\r\n    },\r\n    speed: {\r\n      type: Number,\r\n      default: 4\r\n    },\r\n    autoPlay: {\r\n      type: Boolean,\r\n      default: false\r\n    },\r\n    interval: {\r\n      type: Number,\r\n      default: 3000\r\n    },\r\n    isMotion: {\r\n      type: Boolean,\r\n      default: false\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      count: 0,\r\n      items: [],\r\n      rotation: Math.PI / 2,\r\n      destRotation: Math.PI / 2,\r\n      lastTime: Date.now(),\r\n      timer: 0,\r\n      autoPlayTimer: null,\r\n      uniformMotionTimer: null,\r\n      index: 0\r\n    };\r\n  },\r\n  computed: {\r\n    styleObj() {\r\n      return {\r\n        width: this.width,\r\n        height: this.height\r\n      };\r\n    },\r\n    yR() {\r\n      return this.yRadius || this.$el.offsetHeight / 6;\r\n    },\r\n    xR() {\r\n      return this.xRadius || this.$el.offsetWidth / 2.3;\r\n    },\r\n    xOrigin() {\r\n      return this.$el.offsetWidth / 2;\r\n    },\r\n    yOrigin() {\r\n      return this.$el.offsetHeight / 10;\r\n    },\r\n    activeIndex() {\r\n      return Math.round(this.floatIndex()) % this.count;\r\n    }\r\n  },\r\n  mounted() {\r\n    this.initItem();\r\n    if (this.autoPlay) this.start();\r\n    this.uniformMotion();\r\n  },\r\n  methods: {\r\n    initItem() {\r\n      //   this.$nextTick(() => {\r\n      let radians = this.rotation;\r\n      this.count = this.items.length;\r\n      let space = (2 * Math.PI) / this.count;\r\n      this.items.forEach(ele => {\r\n        ele.rotation = radians;\r\n        ele.renderItem();\r\n        radians += space;\r\n      });\r\n      //   });\r\n    },\r\n    scheduleNextFrame() {\r\n      this.lastTime = Date.now();\r\n      this.timer = window.requestAnimationFrame(this.playFrame);\r\n    },\r\n    play() {\r\n      if (this.timer === 0) {\r\n        this.scheduleNextFrame();\r\n      }\r\n    },\r\n    playFrame() {\r\n      var rem = this.destRotation - this.rotation;\r\n      var now = Date.now();\r\n      var dt = (now - this.lastTime) * 0.002;\r\n      this.lastTime = now;\r\n      if (Math.abs(rem) < 0.003) {\r\n        this.rotation = this.destRotation;\r\n        this.pause();\r\n        this.$emit(\"change\", this.activeIndex);\r\n        this.uniformMotion();\r\n        if (typeof this.onAnimationFinished === \"function\")\r\n          this.onAnimationFinished();\r\n      } else {\r\n        // 渐近地接近目标\r\n        this.rotation = this.destRotation - rem / (1 + this.speed * dt);\r\n        this.scheduleNextFrame();\r\n      }\r\n\r\n      this.initItem();\r\n    },\r\n    pause() {\r\n      console.log(\"暂停\");\r\n      window.cancelAnimationFrame(this.timer);\r\n      this.timer = 0;\r\n    },\r\n    go(count) {\r\n      this.destRotation += ((2 * Math.PI) / this.count) * count;\r\n      this.play();\r\n    },\r\n    goTo(index) {\r\n      this.stopMotion();\r\n      this.stop();\r\n      //找到将项目旋转到前面的最短方法\r\n      let diff = index - (this.floatIndex() % this.count);\r\n\r\n      if (2 * Math.abs(diff) > this.count)\r\n        diff -= diff > 0 ? this.count : -this.count;\r\n\r\n      // 停止任何正在进行的旋转\r\n      this.destRotation = this.rotation;\r\n\r\n      // 旋转相反的方向把项目带到前面\r\n      this.go(-diff);\r\n\r\n      // 返回到目标的旋转距离(以项目为单位)\r\n      return diff;\r\n    },\r\n    itemsRotated() {\r\n      return (this.count * (Math.PI / 2 - this.rotation)) / (2 * Math.PI);\r\n    },\r\n    floatIndex() {\r\n      let floatIndex = this.itemsRotated() % this.count;\r\n\r\n      // 确保float-index是正的\r\n      return floatIndex < 0 ? floatIndex + this.count : floatIndex;\r\n    },\r\n    start() {\r\n      this.autoPlayTimer = setInterval(() => {\r\n        this.go(1);\r\n      }, this.interval);\r\n    },\r\n    stop() {\r\n      clearInterval(this.autoPlayTimer);\r\n    },\r\n    uniformMotion() {\r\n      if (this.activeIndex != this.index) {\r\n        this.index = this.activeIndex;\r\n        this.$emit(\"change\", this.index);\r\n      }\r\n\r\n      this.rotation += 0.005;\r\n      this.initItem();\r\n      this.uniformMotionTimer = window.requestAnimationFrame(\r\n        this.uniformMotion\r\n      );\r\n    },\r\n    stopMotion() {\r\n      window.cancelAnimationFrame(this.uniformMotionTimer);\r\n    }\r\n  },\r\n\r\n  components: {},\r\n  beforeDestroy() {}\r\n};\r\n</script>\r\n\r\n<style lang=\"css\" scoped>\r\n</style>\r\n"]}]}